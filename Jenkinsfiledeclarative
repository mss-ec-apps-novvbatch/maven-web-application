 pipeline {

  agent any
  
  tools {
 maven 'maven3.8.4'
 }
 triggers {
  pollSCM '* * * * *'
   //cron '* * * * *'
}

options {
// add the time stamp to the console output
  timestamps()

//Discard old bills
  buildDiscarder logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '5', daysToKeepStr: '', numToKeepStr: '5')
}



  stages {

    //get the code from github

     stage('checkoutcode'){

    steps{

     git branch: 'development', credentialsId: '1a75dcca-80db-4226-b3cc-28ab48cc4a5e', url: 'https://github.com/mss-ec-apps-novvbatch/maven-web-application.git'
        }
   }
   
   //Do the build
   
   stage('Build'){
   
   steps{
   sh "mvn clean package"
   }
   }

    //execute sonarqube report
	
   stage('Execute'){
   
   steps{
   sh "mvn clean sonar:sonar"
   }
   }
   //Upload artifact into nexus server
   
   stage('Upload'){
   steps{
   sh "mvn clean deploy"
   }
   }
   
   //deploy app into Tomcat
   
   stage('deploy app into Tomcat'){
   steps{
   sshagent(['2b1fc561-1658-4c8e-a069-31eb09c7f97c']) {
    sh "scp -o  StrictHostKeyChecking=no target/maven-web-application.war ec2-user@3.108.193.26:/opt/apache-tomcat-9.0.58/webapps/"}
   }
  } 
   
         }//stages closing
		 
		 post {
  always {
   emailext body: '''Buildover

       Regards,
        Sudhakar reddy sura''', subject: 'buildover', to: 'sudhakarreddy7300@gmail.com'
  }
  success {
    emailext body: '''Buildover... success

       Regards,
        Sudhakar reddy sura''', subject: 'buildover', to: 'sudhakarreddy7300@gmail.com'
  }
  failure {
    emailext body: '''Buildover.. failure

       Regards,
        Sudhakar reddy sura''', subject: 'buildover', to: 'sudhakarreddy7300@gmail.com'
  }
}

		 
		 
		 
		 
		 
		 
		 
   }//pipeline closing
